/*
 * jQuery GrewForm Plugin v0.0.3
 *
 * Copyright 2011, Artem Suschev
 * Grandcapital Ltd.
 *  
 * Licensed under the MIT license (license.txt)
 */
(function(){jQuery.fn.grewform=function(k){jQuery("input,textarea").live("keyup change",function(p){var n=[33,34,36,35,45,38,40,37,39];if(p.keyCode&&jQuery.inArray(p.keyCode,n)<0){var o=d(this);jQuery(this).attr("value",this.value);a(this,o)}});var l=this;for(var j in k){var m=new b(j,l,k[j])}l.find("*").keyup(function(){var n=setInterval(function(){clearInterval(n);h()},300)});jQuery(document).ready(function(){h()});return l.find("*").change(function(){h()})};jQuery.fn.grewform.reset=function(){b.id=undefined;b.all=[]};jQuery.fn.grewform.runRules=function(){h()};function c(j){}function h(){jQuery.each(b.all,function(j,k){(function(m){var l=setInterval(function(){try{if(!b.form.find("*").is(":animated")){clearInterval(l);if(m.unmatches()){m.run_unmatch_actions()}}}catch(n){clearInterval(l)}},200)}(k))});jQuery.each(b.all,function(j,k){(function(m){var l=setInterval(function(){try{if(!b.form.find("*").is(":animated")){clearInterval(l);if(m.matches()){m.run_match_actions()}}}catch(n){clearInterval(l)}},200)}(k))})}function b(k,m,j){if(typeof b.id=="undefined"){b.id=0;b.blip_ptr="hgo_grewform_rule";b.unmtach_by_blip=function(n){jQuery.each(b.all,function(o,p){if(p.blip===n){p.run_unmatch_actions()}})};b.all=[];b.form=m}this.id=b.id;b.id=b.id+1;this.blip=b.blip_ptr+this.id;this.selectors=g((""+k).split("AND"));jQuery.each(this.selectors,function(n){return function(p,o){n[p]=jQuery.trim(""+o)}}(this.selectors));this.selector=i(this.selectors);this.trigged=false;this.match_actions=[];this.unmatch_actions=[];this.raw=j;this.raw_selector=k;for(var l in j){e(l,m,this)}this.matches=function(){for(var o=0;o<this.selectors.length;o++){var n=this.selectors[o];if((!this.trigged)){if(b.form.find(n).filter("option:first").length>0){if(b.form.find(n).parent("select:visible:first").length===0){return false}}else{if(b.form.find(n).filter(":visible:first,input[type=hidden]:first").length===0){return false}}}else{return false}}return true};this.unmatches=function(){if(!this.trigged){return false}for(var o=0;o<this.selectors.length;o++){var n=this.selectors[o];if(b.form.find(n+":first").length===0){return true}}return false};this.run_match_actions=function(){c("match: "+this.raw_selector);this.trigged=true;b.form.find(this.selector).addClass(this.blip);for(var n=0;n<this.match_actions.length;n++){var o=this.match_actions[n];o.call(this)}};this.run_match_actions.first_run=true;this.run_unmatch_actions=function(){c("unmatch: "+this.raw_selector);this.trigged=false;jQuery("."+this.blip).removeClass(this.blip);for(var n=0;n<this.unmatch_actions.length;n++){var o=this.unmatch_actions[n];o.call(this)}};b.all.push(this)}function e(m,n,o){switch(m){case"show":o.match_actions.push(function(p){return function(){if(p.is("option")){p.show()}else{p.slideDown()}}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);if(p.is("option")){p.hide()}else{p.slideUp()}}}(n.find(o.raw[m])));break;case"hide":o.match_actions.push(function(p){return function(){if(p.is("option")){p.hide()}else{p.slideUp()}}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);if(p.is("option")){p.show()}else{p.slideDown()}}}(n.find(o.raw[m])));break;case"set_value":o.match_actions.push(function(p){return function(){var q=this;jQuery.each(p,function(r,s){jQuery.each(b.form.find(r),function(){var t=jQuery(this).tagName;if(t=="select"){elems.find("option").removeAttr("selected");elems.find("option [value="+s+"]").attr("selected","selected")}else{jQuery(this).val(s)}})})}}(o.raw[m]));break;case"add_options":for(var j in o.raw[m]){var l=o.raw[m][j];if(typeof l=="function"){o.match_actions.push(function(r,p,q){return function(){var t=q();for(var s in t){var u=r.find(p);jQuery("<option></option>").html(t[s]).val(s).appendTo(u)}if(this.run_match_actions.first_run){for(var s in t){this.unmatch_actions.push(function(y,w,x){return function(){f(y.children(w).children("option[value="+x+"]"));y.find(w).children().remove("option[value="+x+"]")}}(n,p,s))}this.run_match_actions.first_run=false}}}(n,j,l))}else{for(var k in l){o.match_actions.push(function(s,p,q,r){return function(){var t=s.find(p);jQuery("<option></option>").html(r).val(q).appendTo(t)}}(n,j,k,l[k]));o.unmatch_actions.push(function(r,p,q){return function(){f(r.children(p).children("option[value="+q+"]"));r.find(p).children().remove("option[value="+q+"]")}}(n,j,k))}}}break;case"disable":o.match_actions.push(function(p){return function(){p.attr("disabled","disabled")}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);p.removeAttr("disabled")}}(n.find(o.raw[m])));break;case"enable":o.match_actions.push(function(p){return function(){p.removeAttr("disabled")}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);p.attr("disabled","disabled")}}(n.find(o.raw[m])));break;case"check":o.match_actions.push(function(p){return function(){p.attr("checked","checked")}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);p.removeAttr("checked")}}(n.find(o.raw[m])));break;case"uncheck":o.match_actions.push(function(p){return function(){p.removeAttr("checked")}}(n.find(o.raw[m])));o.unmatch_actions.push(function(p){return function(){f(p);p.attr("checked","checked")}}(n.find(o.raw[m])));break;case"custom":o.match_actions.push(function(q,p){return function(){q.call(p)}}(o.raw[m]["match"],jQuery(o.selector)));o.unmatch_actions.push(function(q,p){return function(){q.call(p)}}(o.raw[m]["unmatch"],jQuery(o.selector)));break;default:return}}function f(j){jQuery.each(j,function(){var l=jQuery(this);if(l.attr("class")!==undefined){var k=l.attr("class").split(" ")}else{return}jQuery.each(k,function(n,m){b.unmtach_by_blip(m)});f(l.children())})}function g(j){if(j.constructor!==Array){return[j]}return j}function i(j){res="";for(var k=0;k<j.length;k++){res+=jQuery.trim(""+j[k])+","}return res}function d(k){var l=0;if(document.selection){k.focus();var j=document.selection.createRange();j.moveStart("character",-k.value.length);l=Sel.text.length}else{if(k.selectionStart||k.selectionStart=="0"){l=k.selectionStart}}return(CaretPos)}function a(k,l){if(k.setSelectionRange){k.focus();k.setSelectionRange(l,l)}else{if(k.createTextRange){var j=k.createTextRange();j.collapse(true);j.moveEnd("character",l);j.moveStart("character",l);j.select()}}}})();